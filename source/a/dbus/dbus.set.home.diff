Set HOME environment variable when switching user.

2011-08-05 Egor Y. Egorov

References:
https://bugs.freedesktop.org/show_bug.cgi?id=39857
https://bugs.kde.org/show_bug.cgi?id=249217#c27

diff --git a/bus/activation-helper.c b/bus/activation-helper.c
index baba8f0..b75ea7c 100644
--- a/bus/activation-helper.c
+++ b/bus/activation-helper.c
@@ -344,6 +344,8 @@ switch_user (char *user, DBusError *error)
                       "cannot setuid user %i", pw->pw_uid);
       return FALSE;
     }
+
+  _dbus_setenv ("HOME", pw->pw_dir);
 #endif
   return TRUE;
 }

