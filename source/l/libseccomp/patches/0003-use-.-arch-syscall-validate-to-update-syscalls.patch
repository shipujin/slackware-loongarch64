From 9cbe9b50b234142f9879d3129ea2c1e5900a22fb Mon Sep 17 00:00:00 2001
From: Xiaotian Wu <wuxiaotian@loongson.cn>
Date: Sat, 6 Nov 2021 14:13:49 +0800
Subject: [PATCH 03/16] use "./arch-syscall-validate" to update syscalls

Signed-off-by: Xiaotian Wu <wuxiaotian@loongson.cn>
Signed-off-by: Shi Pujin <shipujin.t@gmail.com>
---
 src/arch-syscall-validate | 7 +++----
 src/syscalls.csv          | 6 ++++--
 2 files changed, 7 insertions(+), 6 deletions(-)

diff --git a/src/arch-syscall-validate b/src/arch-syscall-validate
index cee113c..618a70c 100755
--- a/src/arch-syscall-validate
+++ b/src/arch-syscall-validate
@@ -318,21 +318,20 @@ function dump_sys_loongarch64() {
 
 	sed_filter+='s/__NR3264_fadvise64/223/;'
 	sed_filter+='s/__NR3264_fcntl/25/;'
-	sed_filter+='s/__NR3264_fstat/80/;'
-	sed_filter+='s/__NR3264_fstatat/79/;'
 	sed_filter+='s/__NR3264_fstatfs/44/;'
+	sed_filter+='s/__NR3264_fstatat/79/;'
+	sed_filter+='s/__NR3264_fstat/80/;'
 	sed_filter+='s/__NR3264_ftruncate/46/;'
 	sed_filter+='s/__NR3264_lseek/62/;'
 	sed_filter+='s/__NR3264_lstat/1039/;'
 	sed_filter+='s/__NR3264_mmap/222/;'
 	sed_filter+='s/__NR3264_sendfile/71/;'
-	sed_filter+='s/__NR3264_stat/1038/;'
 	sed_filter+='s/__NR3264_statfs/43/;'
+	sed_filter+='s/__NR3264_stat/1038/;'
 	sed_filter+='s/__NR3264_truncate/45/;'
 
 	gcc -E -dM -I$1/include/uapi \
 		-D__BITS_PER_LONG=64 \
-		-D__ARCH_WANT_NEW_STAT \
 		-D__ARCH_WANT_SYS_CLONE \
 		-D__ARCH_WANT_SYS_CLONE3 \
 		$1/arch/loongarch/include/uapi/asm/unistd.h | \
diff --git a/src/syscalls.csv b/src/syscalls.csv
index 74e2e70..8431c6b 100644
--- a/src/syscalls.csv
+++ b/src/syscalls.csv
@@ -99,6 +99,7 @@ ftruncate,93,77,77,93,46,46,93,75,75,93,93,93,93,46,93,93
 ftruncate64,194,PNR,PNR,194,PNR,PNR,212,PNR,PNR,200,200,194,PNR,PNR,194,PNR
 futex,240,202,202,240,98,98,238,194,194,210,210,221,221,98,238,238
 futex_time64,422,PNR,PNR,422,PNR,PNR,422,PNR,422,422,PNR,422,PNR,PNR,422,PNR
+futex_waitv,449,449,449,449,449,449,449,449,449,449,449,449,449,449,449,449
 futimesat,299,261,261,326,PNR,PNR,292,251,255,279,279,290,290,PNR,292,292
 getcpu,318,309,309,345,168,168,312,271,275,296,296,302,302,168,311,311
 getcwd,183,79,79,183,17,17,203,77,77,110,110,182,182,17,183,183
@@ -191,7 +192,7 @@ madvise,219,28,28,220,233,233,218,27,27,119,119,205,205,233,219,219
 mbind,274,237,237,319,235,235,268,227,231,260,260,259,259,235,268,268
 membarrier,375,324,324,389,283,283,358,318,322,343,343,365,365,283,356,356
 memfd_create,356,319,319,385,279,279,354,314,318,340,340,360,360,279,350,350
-memfd_secret,447,447,447,PNR,447,PNR,PNR,PNR,PNR,PNR,PNR,PNR,PNR,PNR,PNR,PNR
+memfd_secret,447,447,447,PNR,447,PNR,PNR,PNR,PNR,PNR,PNR,PNR,PNR,447,PNR,PNR
 migrate_pages,294,256,256,400,238,238,287,246,250,272,272,258,258,238,287,287
 mincore,218,27,27,219,232,232,217,26,26,72,72,206,206,232,218,218
 mkdir,39,83,83,39,PNR,PNR,39,81,81,39,39,39,39,PNR,39,39
@@ -230,7 +231,7 @@ munlockall,153,152,152,153,231,231,157,149,149,153,153,153,153,231,153,153
 munmap,91,11,11,91,215,215,91,11,11,91,91,91,91,215,91,91
 name_to_handle_at,341,303,303,370,264,264,339,298,303,325,325,345,345,264,335,335
 nanosleep,162,35,35,162,101,101,166,34,34,162,162,162,162,101,162,162
-newfstatat,PNR,262,262,PNR,79,79,PNR,252,256,PNR,PNR,PNR,291,79,PNR,293
+newfstatat,PNR,262,262,PNR,79,PNR,PNR,252,256,PNR,PNR,PNR,291,79,PNR,293
 _newselect,142,PNR,PNR,142,PNR,PNR,142,22,22,142,142,142,142,PNR,142,PNR
 nfsservctl,169,180,PNR,169,42,42,189,173,173,PNR,PNR,168,168,42,169,169
 nice,34,PNR,PNR,34,PNR,PNR,34,PNR,PNR,34,34,34,34,PNR,34,34
@@ -359,6 +360,7 @@ setgroups32,206,PNR,PNR,206,PNR,PNR,PNR,PNR,PNR,PNR,PNR,PNR,PNR,PNR,206,PNR
 sethostname,74,170,170,74,161,161,74,165,165,74,74,74,74,161,74,74
 setitimer,104,38,38,104,103,103,104,36,36,104,104,104,104,103,104,104
 set_mempolicy,276,238,238,321,237,237,270,229,233,262,262,261,261,237,270,270
+set_mempolicy_home_node,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450,450
 setns,346,308,308,375,268,268,344,303,308,328,328,350,350,268,339,339
 setpgid,57,109,109,57,154,154,57,107,107,57,57,57,57,154,57,57
 setpriority,97,141,141,97,140,140,97,138,138,97,97,97,97,140,97,97
-- 
2.41.0

