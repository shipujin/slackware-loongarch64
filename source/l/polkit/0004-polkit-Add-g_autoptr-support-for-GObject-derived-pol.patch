From 004bd37d0b33eb39372bd0e0bed8ab9c1ac2c50c Mon Sep 17 00:00:00 2001
From: Philip Withnall <philip.withnall@collabora.co.uk>
Date: Fri, 22 Apr 2016 12:34:18 +0100
Subject: [PATCH 04/16] polkit: Add g_autoptr() support for GObject-derived
 polkit types
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Add G_DEFINE_AUTOPTR_CLEANUP_FUNC calls to polkittypes.h, so that
g_autoptr() can be used with polkit objects.

This is conditional on GLib â‰¥ 2.44.0 being available. It does not bump
polkitâ€™s dependency on GLib.

https://bugs.freedesktop.org/show_bug.cgi?id=95065
---
 src/polkit/polkittypes.h | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)

diff --git a/src/polkit/polkittypes.h b/src/polkit/polkittypes.h
index 3de1778..e0cf653 100644
--- a/src/polkit/polkittypes.h
+++ b/src/polkit/polkittypes.h
@@ -64,4 +64,21 @@ typedef struct _PolkitTemporaryAuthorization PolkitTemporaryAuthorization;
 struct _PolkitPermission;
 typedef struct _PolkitPermission PolkitPermission;
 
+#if GLIB_CHECK_VERSION(2, 44, 0)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC (PolkitAuthority, g_object_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC (PolkitActionDescription, g_object_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC (PolkitSubject, g_object_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC (PolkitUnixProcess, g_object_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC (PolkitUnixSession, g_object_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC (PolkitSystemBusName, g_object_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC (PolkitIdentity, g_object_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC (PolkitUnixUser, g_object_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC (PolkitUnixGroup, g_object_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC (PolkitUnixNetgroup, g_object_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC (PolkitAuthorizationResult, g_object_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC (PolkitDetails, g_object_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC (PolkitTemporaryAuthorization, g_object_unref)
+G_DEFINE_AUTOPTR_CLEANUP_FUNC (PolkitPermission, g_object_unref)
+#endif
+
 #endif /* __POLKIT_TYPES_H */
-- 
2.13.0

