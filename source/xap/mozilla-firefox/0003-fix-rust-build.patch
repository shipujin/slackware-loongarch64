From 8ceffbfcb1b058b0ed033ce6d09e9c51217aa6c9 Mon Sep 17 00:00:00 2001
From: Your Name <you@example.com>
Date: Mon, 12 Jun 2023 09:42:50 +0800
Subject: [PATCH 3/4] fix rust build


diff --git a/third_party/rust/authenticator/build.rs b/third_party/rust/authenticator/build.rs
index c972d85b89..3b2f12171f 100644
--- a/third_party/rust/authenticator/build.rs
+++ b/third_party/rust/authenticator/build.rs
@@ -47,6 +47,8 @@ fn main() {
         "ioctl_s390xbe.rs"
     } else if cfg!(all(target_arch = "riscv64", target_endian = "little")) {
         "ioctl_riscv64.rs"
+    } else if cfg!(all(target_arch = "loongarch64", target_endian = "little")) {
+        "ioctl_loongarch64.rs"
     } else {
         panic!("architecture not supported");
     };
diff --git a/third_party/rust/authenticator/src/transport/linux/hidwrapper.rs b/third_party/rust/authenticator/src/transport/linux/hidwrapper.rs
index 82aabc6301..bc8582c5b1 100644
--- a/third_party/rust/authenticator/src/transport/linux/hidwrapper.rs
+++ b/third_party/rust/authenticator/src/transport/linux/hidwrapper.rs
@@ -49,3 +49,6 @@ include!("ioctl_s390xbe.rs");
 
 #[cfg(all(target_arch = "riscv64", target_endian = "little"))]
 include!("ioctl_riscv64.rs");
+
+#[cfg(all(target_arch = "loongarch64", target_endian = "little"))]
+include!("ioctl_loongarch64.rs");
diff --git a/third_party/rust/authenticator/src/transport/linux/ioctl_loongarch64.rs b/third_party/rust/authenticator/src/transport/linux/ioctl_loongarch64.rs
new file mode 100644
index 0000000000..a784e9bf46
--- /dev/null
+++ b/third_party/rust/authenticator/src/transport/linux/ioctl_loongarch64.rs
@@ -0,0 +1,5 @@
+/* automatically generated by rust-bindgen */
+
+pub type __u32 = ::std::os::raw::c_uint;
+pub const _HIDIOCGRDESCSIZE: __u32 = 2147764225;
+pub const _HIDIOCGRDESC: __u32 = 2416199682;
diff --git a/third_party/rust/cty/src/lib.rs b/third_party/rust/cty/src/lib.rs
index 971c9cb3a9..80b8f3f291 100644
--- a/third_party/rust/cty/src/lib.rs
+++ b/third_party/rust/cty/src/lib.rs
@@ -24,6 +24,7 @@ pub use pwd::*;
           target_arch = "powerpc",
           target_arch = "powerpc64",
           target_arch = "s390x",
+          target_arch = "loongarch64",
           target_arch = "riscv32",
           target_arch = "riscv64"))]
 mod ad {
diff --git a/third_party/rust/nix/src/sys/ioctl/linux.rs b/third_party/rust/nix/src/sys/ioctl/linux.rs
index 9cdac72a4b..5e293b053f 100644
--- a/third_party/rust/nix/src/sys/ioctl/linux.rs
+++ b/third_party/rust/nix/src/sys/ioctl/linux.rs
@@ -33,6 +33,7 @@ mod consts {
           target_arch = "arm",
           target_arch = "s390x",
           target_arch = "x86_64",
+          target_arch = "loongarch64",
           target_arch = "aarch64"))]
 mod consts {
     #[doc(hidden)]
-- 
2.39.1

