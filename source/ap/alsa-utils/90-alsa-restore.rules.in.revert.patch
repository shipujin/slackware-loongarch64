--- ./alsactl/90-alsa-restore.rules.in.orig	2024-11-12 03:36:54.000000000 -0600
+++ ./alsactl/90-alsa-restore.rules.in	2024-06-10 04:18:36.000000000 -0500
@@ -1,28 +1,8 @@
-# do not edit this file, it will be overwritten on update
-
-ACTION=="add", SUBSYSTEM=="sound", KERNEL=="controlC*", KERNELS!="card*",@extratest@ GOTO="alsa_restore_go"
+ACTION=="add", SUBSYSTEM=="sound", KERNEL=="controlC*", KERNELS!="card*", TEST=="@sbindir@", TEST=="@mydatadir@", GOTO="alsa_restore_go"
 GOTO="alsa_restore_end"
 
-ENV{ALSA_CARD_NUMBER}="$attr{device/number}"
-
-# mark HDA analog card; HDMI/DP card does not have capture devices
-DRIVERS=="snd_hda_intel", TEST=="device/pcmC$env{ALSA_CARD_NUMBER}D0p", RUN+="/bin/sh -c 'echo ALSA_CARD_HDA_ANALOG=$env{ALSA_CARD_NUMBER} >> /run/udev/alsa-hda-analog-card'"
-
-# check for ACP hardware
-TEST=="device/device/acp3x-dmic-capture", GOTO="alsa_hda_analog"
-TEST=="device/device/acp6x-dmic-capture", GOTO="alsa_hda_analog"
-TEST=="device/device/acp63-dmic-capture", GOTO="alsa_hda_analog"
-TEST=="device/device/acp-pdm-dmic", GOTO="alsa_hda_analog"
-GOTO="alsa_restore_std"
-
-LABEL="alsa_hda_analog"
-# restore configuration for profile with combined cards (HDA + digital mic)
-TEST!="/run/udev/alsa-hda-analog-card", GOTO="alsa_restore_std"
-IMPORT{program}="/usr/bin/cat /run/udev/alsa-hda-analog-card"
-ENV{ALSA_CARD_HDA_ANALOG}!="", ENV{ALSA_CARD_NUMBER}="$env{ALSA_CARD_HDA_ANALOG}"
-
 LABEL="alsa_restore_go"
-TEST!="@daemonswitch@", RUN+="@sbindir@/alsactl@args@ restore $env{ALSA_CARD_NUMBER}"
-TEST=="@daemonswitch@", RUN+="@sbindir@/alsactl@args@ nrestore $env{ALSA_CARD_NUMBER}"
+TEST!="@daemonswitch@", RUN+="@sbindir@/alsactl restore $devnode"
+TEST=="@daemonswitch@", RUN+="@sbindir@/alsactl nrestore $devnode"
 
 LABEL="alsa_restore_end"
